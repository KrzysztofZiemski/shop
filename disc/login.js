!function(e){var t={};function s(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,o){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(o,r,function(t){return e[t]}.bind(null,r));return o},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=9)}([function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));class o{constructor(){this.url="http://localhost:3000/server/",this.tags=["niebieski","czarny","różowy","pomarańczowy","srebrny","czerwnoy","biały","brązowy","żółty","szary","złoty","zielony","fioletowy"],this.category=[{brooches:"Broszki"},{bracelets:"Bransoletki"},{earrings:"Kolczyki"},{yarn:"Szydełkowe twory"},{bags:"Torebki"},{tedy:"Maskotki"},{hwawl:"Chusty"},{}]}}},,function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var o=s(0);class r{constructor(){this.config=new o.a,this.urlProducts=this.config.url+"/api/",this.urlUsers=this.config.url+"/users/"}getCookies(){const e=decodeURIComponent(document.cookie).split(";");if(!e[0])return null;const t={};return e.forEach(e=>{const s=e.split("="),o=s[0].trim(),r=s[1].trim();t[o]=r}),t}setCookie(e,t,s=2592e3){let o=t;"object"==typeof t&&(o=JSON.stringify(t)),document.cookie=`${e}=${o};Max-Age=${s};path=/`}getAll(){return fetch(this.urlProducts).then(e=>{if(200!==e.status)throw e.status;return e.json()})}getCategory(e){const t=this.urlProducts+"/filter?"+e;return fetch(t).then(e=>{if(200!==e.status)throw e.status;return e.json()})}get(e){return fetch(`${this.urlProducts}/${e}`).then(e=>{if(200!==e.status)throw e.status;return e.json()})}async add(e){const t=this.getCookies(),s=t.accessToken,o=t.refreshToken,r=new FormData;for(let t in e)r.append(t,e[t]);const n=await fetch(this.urlProducts,{method:"POST",body:r,headers:{Authorization:`Bearer ${s}`}});if(401===n.status){if(await this.refreshToken(o)){const e=this.getCookies().accessToken;n=await fetch(`${this.urlProducts}`,{method:"POST",body:r,headers:{Authorization:`Bearer ${e}`}})}}return n}async change(e,t){const s=this.getCookies(),o=s.accessToken,r=s.refreshToken,n=new FormData;for(let e in t)n.append(e,t[e]);let i=await fetch(`${this.urlProducts}${e}`,{method:"put",body:n,headers:{Authorization:`Bearer ${o}`}});if(401===i.status){if(await this.refreshToken(r)){const t=this.getCookies().accessToken;i=await fetch(`${this.urlProducts}${e}`,{method:"put",body:n,headers:{Authorization:`Bearer ${t}`}})}}}async getUser(){let e=this.getCookies();if(null!==e&&!e.hasOwnProperty("accessToken")&&e.hasOwnProperty("refreshToken")){if(!await this.refreshToken(e.refreshToken))return;e=this.api.getCookies()}try{return await e.hasOwnProperty("accessToken")?await this.getUserByToken():null}catch(e){return null}}async remove(e){const t=this.getCookies(),s=t.accessToken,o=t.refreshToken;let r=fetch(`${this.urlProducts}${e}`,{method:"delete",headers:{Authorization:`Bearer ${s}`}});if(401===r.status){if(await this.refreshToken(o)){const t=this.getCookies().accessToken;r=await fetch(`${this.urlProducts}${e}`,{method:"delete",headers:{Authorization:`Bearer ${t}`}})}if(200!==r.status)throw res.status;return r.json()}}async getUserByToken(e){const t=this.getCookies().accessToken;return await fetch(`${this.urlUsers}user`,{method:"GET",headers:{Authorization:`Bearer ${t}`}}).then(e=>e.json()).catch(e=>console.log(e))}async refreshToken(e){const t=this.config.url+"/auth/token",s={refreshToken:e},o=await fetch(t,{method:"PUT",body:JSON.stringify(s),headers:{"Content-type":"application/json; charset=UTF-8"}});if(200===o.status){const e=await o.json();return this.setCookie("accessToken",e.accessToken,600),this.setCookie("refreshToken",e.refreshToken,10800),!0}return console.log("refreshTokenStatus ",o.status),!1}async uploadBasket(e){const t=this.getCookies(),s=t.accessToken,o=t.refreshToken;let r=await fetch(`${this.urlUsers}basket`,{method:"put",body:JSON.stringify(e),headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`}});if(401===r.status){if(await this.refreshToken(o)){const t=this.getCookies().accessToken;r=await fetch(`${this.urlUsers}basket`,{method:"put",body:e,headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}})}}}buy(e){return fetch("http://localhost:3000/server/transactions/buy",{method:"post",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})}}},function(e,t,s){},,,,,,function(e,t,s){"use strict";s.r(t);var o=s(0),r=s(2);s(3);new class{constructor(){this.config=new o.a,this.url=this.config.url+"/auth/",this.form=document.querySelector("#loginForm"),this.login=document.querySelector("#login"),this.password=document.querySelector("#password"),this.message=document.querySelector("#message"),this.form&&this.form.addEventListener("submit",this.handleLogin.bind(this)),this.api=new r.a}handleLogin(e){e.preventDefault();const t={login:this.login.value,password:this.password.value};fetch(this.url+"login",{method:"POST",body:JSON.stringify(t),headers:{"Content-type":"application/json; charset=UTF-8"}}).then(e=>{if(200===e.status)return e.json();throw 400===e.status&&(window.location.replace("./?message=brak dostępu"),this.message.innerText="błędny login lub hasło"),Error(e.status)}).then(e=>{const{accessToken:t,refreshToken:s}=e;if(void 0===t&&void 0===s)return window.location.replace("./?message=brak dostępu");this.api.setCookie("accessToken",t,600),this.api.setCookie("refreshToken",s,10800),window.location.replace("/?message=zalogowano")}).catch(e=>{this.message.innerText=`błąd serwera ${e} spróbuj ponownie`})}}}]);