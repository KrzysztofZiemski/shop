!function(e){var t={};function s(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=10)}([function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));class n{constructor(){this.url="http://localhost:3000/server/",this.tags=["niebieski","czarny","różowy","pomarańczowy","srebrny","czerwnoy","biały","brązowy","żółty","szary","złoty","zielony","fioletowy"],this.category=[{brooches:"Broszki"},{bracelets:"Bransoletki"},{earrings:"Kolczyki"},{yarn:"Szydełkowe twory"},{bags:"Torebki"},{tedy:"Maskotki"},{hwawl:"Chusty"},{}]}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var n=s(0);class r{constructor(){this.config=new n.a,this.urlProducts=this.config.url+"/api/",this.urlUsers=this.config.url+"/users/"}getCookies(){const e=decodeURIComponent(document.cookie).split(";");if(!e[0])return null;const t={};return e.forEach(e=>{const s=e.split("="),n=s[0].trim(),r=s[1].trim();t[n]=r}),t}setCookie(e,t,s=2592e3){let n=t;"object"==typeof t&&(n=JSON.stringify(t)),document.cookie=`${e}=${n};Max-Age=${s};path=/`}getAll(){return fetch(this.urlProducts).then(e=>{if(200!==e.status)throw e.status;return e.json()})}getCategory(e){const t=this.urlProducts+"/filter?"+e;return fetch(t).then(e=>{if(200!==e.status)throw e.status;return e.json()})}get(e){return fetch(`${this.urlProducts}/${e}`).then(e=>{if(200!==e.status)throw e.status;return e.json()})}async add(e){const t=this.getCookies(),s=t.accessToken,n=t.refreshToken,r=new FormData;for(let t in e)r.append(t,e[t]);const o=await fetch(this.urlProducts,{method:"POST",body:r,headers:{Authorization:`Bearer ${s}`}});if(401===o.status){if(await this.refreshToken(n)){const e=this.getCookies().accessToken;o=await fetch(`${this.urlProducts}`,{method:"POST",body:r,headers:{Authorization:`Bearer ${e}`}})}}return o}async change(e,t){const s=this.getCookies(),n=s.accessToken,r=s.refreshToken,o=new FormData;for(let e in t)o.append(e,t[e]);let a=await fetch(`${this.urlProducts}${e}`,{method:"put",body:o,headers:{Authorization:`Bearer ${n}`}});if(401===a.status){if(await this.refreshToken(r)){const t=this.getCookies().accessToken;a=await fetch(`${this.urlProducts}${e}`,{method:"put",body:o,headers:{Authorization:`Bearer ${t}`}})}}}async getUser(){let e=this.getCookies();if(null!==e&&!e.hasOwnProperty("accessToken")&&e.hasOwnProperty("refreshToken")){if(!await this.refreshToken(e.refreshToken))return;e=this.api.getCookies()}try{return await e.hasOwnProperty("accessToken")?await this.getUserByToken():null}catch(e){return null}}async remove(e){const t=this.getCookies(),s=t.accessToken,n=t.refreshToken;let r=fetch(`${this.urlProducts}${e}`,{method:"delete",headers:{Authorization:`Bearer ${s}`}});if(401===r.status){if(await this.refreshToken(n)){const t=this.getCookies().accessToken;r=await fetch(`${this.urlProducts}${e}`,{method:"delete",headers:{Authorization:`Bearer ${t}`}})}if(200!==r.status)throw res.status;return r.json()}}async getUserByToken(e){const t=this.getCookies().accessToken;return await fetch(`${this.urlUsers}user`,{method:"GET",headers:{Authorization:`Bearer ${t}`}}).then(e=>e.json()).catch(e=>console.log(e))}async refreshToken(e){const t=this.config.url+"/auth/token",s={refreshToken:e},n=await fetch(t,{method:"PUT",body:JSON.stringify(s),headers:{"Content-type":"application/json; charset=UTF-8"}});if(200===n.status){const e=await n.json();return this.setCookie("accessToken",e.accessToken,600),this.setCookie("refreshToken",e.refreshToken,10800),!0}return console.log("refreshTokenStatus ",n.status),!1}async uploadBasket(e){const t=this.getCookies(),s=t.accessToken,n=t.refreshToken;let r=await fetch(`${this.urlUsers}basket`,{method:"put",body:JSON.stringify(e),headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`}});if(401===r.status){if(await this.refreshToken(n)){const t=this.getCookies().accessToken;r=await fetch(`${this.urlUsers}basket`,{method:"put",body:e,headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}})}}}buy(e){return fetch("http://localhost:3000/server/transactions/buy",{method:"post",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var n=s(0);class r{constructor(){this.config=new n.a,this.urlProducts=this.config.url+"/api/",this.urlUsers=this.config.url+"/users/"}getCookies(){const e=decodeURIComponent(document.cookie).split(";");if(!e[0])return null;const t={};return e.forEach(e=>{const s=e.split("="),n=s[0].trim(),r=s[1].trim();t[n]=r}),t}setCookie(e,t,s=2592e3){let n=t;"object"==typeof t&&(n=JSON.stringify(t)),document.cookie=`${e}=${n};Max-Age=${s};path=/`}getAll(){return fetch(this.urlProducts).then(e=>{if(200!==e.status)throw e.status;return e.json()})}getCategory(e){const t=this.urlProducts+"/filter?"+e;return fetch(t).then(e=>{if(200!==e.status)throw e.status;return e.json()})}get(e){return fetch(`${this.urlProducts}/${e}`).then(e=>{if(200!==e.status)throw e.status;return e.json()})}async add(e){const t=this.getCookies(),s=t.accessToken,n=t.refreshToken,r=new FormData;for(let t in e)r.append(t,e[t]);const o=await fetch(this.urlProducts,{method:"POST",body:r,headers:{Authorization:`Bearer ${s}`}});if(401===o.status){if(await this.refreshToken(n)){const e=this.getCookies().accessToken;o=await fetch(`${this.urlProducts}`,{method:"POST",body:r,headers:{Authorization:`Bearer ${e}`}})}}return o}async change(e,t){const s=this.getCookies(),n=s.accessToken,r=s.refreshToken,o=new FormData;for(let e in t)o.append(e,t[e]);let a=await fetch(`${this.urlProducts}${e}`,{method:"put",body:o,headers:{Authorization:`Bearer ${n}`}});if(401===a.status){if(await this.refreshToken(r)){const t=this.getCookies().accessToken;a=await fetch(`${this.urlProducts}${e}`,{method:"put",body:o,headers:{Authorization:`Bearer ${t}`}})}}}async getUser(){let e=this.getCookies();if(null!==e&&!e.hasOwnProperty("accessToken")&&e.hasOwnProperty("refreshToken")){if(!await this.refreshToken(e.refreshToken))return;e=this.api.getCookies()}try{return await e.hasOwnProperty("accessToken")?await this.getUserByToken():null}catch(e){return null}}async remove(e){const t=this.getCookies(),s=t.accessToken,n=t.refreshToken;let r=fetch(`${this.urlProducts}${e}`,{method:"delete",headers:{Authorization:`Bearer ${s}`}});if(401===r.status){if(await this.refreshToken(n)){const t=this.getCookies().accessToken;r=await fetch(`${this.urlProducts}${e}`,{method:"delete",headers:{Authorization:`Bearer ${t}`}})}if(200!==r.status)throw res.status;return r.json()}}async getUserByToken(e){const t=this.getCookies().accessToken;return await fetch(`${this.urlUsers}user`,{method:"GET",headers:{Authorization:`Bearer ${t}`}}).then(e=>e.json()).catch(e=>console.log(e))}async refreshToken(e){const t=this.config.url+"/auth/token",s={refreshToken:e},n=await fetch(t,{method:"PUT",body:JSON.stringify(s),headers:{"Content-type":"application/json; charset=UTF-8"}});if(200===n.status){const e=await n.json();return this.setCookie("accessToken",e.accessToken,600),this.setCookie("refreshToken",e.refreshToken,10800),!0}return console.log("refreshTokenStatus ",n.status),!1}async uploadBasket(e){const t=this.getCookies(),s=t.accessToken,n=t.refreshToken;let r=await fetch(`${this.urlUsers}basket`,{method:"put",body:JSON.stringify(e),headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`}});if(401===r.status){if(await this.refreshToken(n)){const t=this.getCookies().accessToken;r=await fetch(`${this.urlUsers}basket`,{method:"put",body:e,headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}})}}}buy(e){return fetch("http://localhost:3000/server/transactions/buy",{method:"post",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})}}},function(e,t,s){},function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var n=s(1);let r=[];const o=new class{constructor(){this.api=new n.a,this.basketIconCount=document.querySelector("#countBasket"),this.basketContainer=document.querySelector("#handleBuyContainer"),this.basketProductsContainer=document.querySelector("#basketProductsContainer"),this.sumPrice=document.querySelector("#sumPrice"),this.orderForm=document.querySelector("#orderForm"),this.addListeners()}async buyBtn(e){document.querySelector("#basket").classList.add("hide"),this.orderForm.classList.remove("hide");try{this.user=await this.api.getUser()}catch(e){console.log(e)}}backToBasket(){document.querySelector("#basket").classList.remove("hide"),this.orderForm.classList.add("hide")}orderBtn(e){e.preventDefault();const t=document.querySelector("#orderFirstName"),s=document.querySelector("#orderLastName"),n=document.querySelector("#orderZIPcode"),r=document.querySelector("#orderCity"),o=document.querySelector("#orderStreet"),a=document.querySelector("#orderStreetNumber"),i=document.querySelector("#orderMail"),c=document.querySelector("#orderSave");let d=!0;if([t,s,n,r,o,a,i,c].forEach(e=>{if(!e.value)return d=!1,e.setAttribute("placeholder","musisz uzupełnic to pole"),e.classList.add("incorrect");e.classList.remove("incorrect")}),!d)return;this.orderForm.classList.add("hide"),document.querySelector("#confirmOrder").classList.remove("hide");const u=`${t.value} ${s.value}`,h=`${o.value} ${a.value}, ${n.value} ${r.value}`,l=i.value,m=this.user?this.user._id:null;this.confirmBuy(u,h,l,m)}confirmBuy(e,t,s,n){let o=0;const a=r.filter(e=>{if(!0===e.checked)return o+=e.price*e.count,!0});document.querySelector("#totalPriceOrder").innerText=`Do zapłaty ${o} PLN`,document.querySelector("#userConfirm").innerText=`${e}`,document.querySelector("#adressConfirm").innerText=t,document.querySelector("#mailConfirm").innerText=s;const i=document.querySelector("#productsOrder");a.forEach(e=>{const t=document.createElement("div");t.className="confirmProducts";const s=document.createElement("span");s.innerText=e.name;const n=document.createElement("span");n.innerText=`x ${e.count}`;const r=document.createElement("span");r.innerText=`${e.price*e.count} PLN`,t.appendChild(s),t.appendChild(n),t.appendChild(r),i.appendChild(t)});const c={fulName:e,adress:t,mail:s,products:a.map(e=>({id:e._id,count:e.count})),userId:this.user?this.user._id:""};document.querySelector("#confirmOrderBtn").addEventListener("click",e=>this.handleConfirmOrderBtn(e,c))}handleConfirmOrderBtn(e,t){this.api.buy(t).then(t=>{if(200===t.status){const t=document.createElement("div");t.innerText="Zamówienie zostało przyjęte do realizacji. Na podany adres mailowy otrzymasz potwierdzenie zakupu",document.querySelector("#confirmOrder").appendChild(t),e.target.setAttribute("disabled",!0),r=[],this.refreshIconBasket(),this.updateBasketCookies(),this.uploadBasket(),this.refreshTotalPrice()}else if(404===t.status){const e=document.createElement("div");e.innerText="Niewystarczająca ilość jednego z produktów",document.querySelector("#confirmOrder").appendChild(e)}else{const t=document.createElement("div");t.innerText="Błąd zamówienia, prosimy o kontakt",document.querySelector("#confirmOrder").appendChild(t),e.target.setAttribute("disabled",!0)}})}addListeners(){const e=document.querySelector("#basketIcon");e&&e.addEventListener("click",this.showBasket.bind(this));const t=document.querySelector("#closeBasketBtn");t&&t.addEventListener("click",this.hideBasket.bind(this));const s=document.querySelector("#buyBtn");s&&s.addEventListener("click",this.buyBtn.bind(this)),this.orderForm&&this.orderForm.addEventListener("submit",e=>this.orderBtn(e));const n=document.querySelector("#orderFormBack");n&&n.addEventListener("click",()=>this.backToBasket())}updateBasketByCookies(){const e=this.api.getCookies();e&&(r=e.hasOwnProperty("basket")?JSON.parse(e.basket):[],this.refreshIconBasket(),this.refreshBasket(r))}uploadBasket(){const e=this.api.getCookies();e&&e.refreshToken&&this.api.uploadBasket(r)}showBasket(){this.basketContainer.classList.remove("hide")}hideBasket(){this.basketContainer.classList.add("hide"),document.querySelector("#basket").classList.remove("hide"),this.orderForm.classList.add("hide"),document.querySelector("#confirmOrder").classList.add("hide")}getBasket(){return r}setBasket(e){this.refreshIconBasket(),this.refreshBasket(e)}async addToBasket(e){const t=r.findIndex(t=>t._id==e);if(-1!==t)r[t].count++;else{const t=await this.api.get(e),{name:s,price:n,_id:o,image:a}=t,i={name:s,price:n,_id:o,image:a,count:1,checked:!0};r.push(i)}this.refreshBasket(r),this.updateBasketCookies(),this.uploadBasket(),this.refreshTotalPrice()}async removeFromBasket(e){const t=r.findIndex(t=>t._id==e);r.splice(t,1),this.refreshIconBasket(),this.updateBasketCookies(),this.uploadBasket(),this.refreshTotalPrice()}refreshIconBasket(){this.basketIconCount.innerHTML=`(${r.length})`}changeBasketCount(e){const t=r.findIndex(e=>e._id==id);r[t].count=e.target.value,totalSpan.innerText=r[t].count*r[t].price+" PLN",this.updateBasketCookies(),this.uploadBasket(),this.refreshTotalPrice()}increaseBasketCount(e,t,s){const n=r.findIndex(t=>t._id==e);r[n].count++,t.value=r[n].count,s.innerText=r[n].count*r[n].price+" PLN",this.updateBasketCookies(),this.uploadBasket(),this.refreshTotalPrice()}decreaseBasketCount(e,t,s){const n=r.findIndex(t=>t._id==e);r[n].count=r[n].count>1?--r[n].count:r[n].count,t.value=r[n].count,s.innerText=r[n].count*r[n].price+" PLN",this.updateBasketCookies(),this.uploadBasket(),this.refreshTotalPrice()}checkBasketItems(e,t){const s=r.findIndex(e=>e._id==t);r[s].checked=!r[s].checked,this.updateBasketCookies(),this.uploadBasket(),this.refreshTotalPrice()}updateBasketCookies(){this.api.setCookie("basket",r)}refreshBasket(e){this.basketProductsContainer.innerText="",e.forEach(e=>{const t=document.createElement("div");t.className="basketElementMark";const s=document.createElement("span");s.className="Product";const n=document.createElement("input");n.setAttribute("type","checkbox"),e.checked&&n.setAttribute("checked",e.checked),n.addEventListener("change",t=>this.checkBasketItems(t,e._id)),s.appendChild(n),t.appendChild(s);const r=document.createElement("span");r.className="nameArticleBasket",r.innerText=e.name,t.appendChild(r);const o=document.createElement("span"),a=document.createElement("image");a.src=e.image,o.appendChild(a),t.appendChild(o);const i=document.createElement("span");i.innerText=e.price*e.count+" PLN";const c=document.createElement("span"),d=document.createElement("input");d.setAttribute("type","number"),d.setAttribute("min",1),d.value=e.count,d.addEventListener("change",t=>this.changeBasketCount(t,e._id,i));const u=document.createElement("button");u.innerHTML='<i class="fas fa-minus"></i>',u.addEventListener("click",()=>this.decreaseBasketCount(e._id,d,i));const h=document.createElement("button");h.innerHTML='<i class="fas fa-plus"></i>',h.addEventListener("click",()=>this.increaseBasketCount(e._id,d,i)),c.appendChild(u),c.appendChild(d),c.appendChild(h),t.appendChild(c);const l=document.createElement("span"),m=document.createElement("button");m.innerHTML='<i class="fas fa-trash-alt"></i>',m.addEventListener("click",()=>{t.remove(),this.removeFromBasket()}),l.appendChild(m),t.appendChild(l),t.appendChild(i),this.basketProductsContainer.appendChild(t),this.refreshTotalPrice(),this.refreshIconBasket()})}refreshTotalPrice(){let e=0;r.forEach(t=>{t.checked&&(e+=t.count*t.price)});const t=document.createElement("span");t.innerText=`${e} PLN`,this.sumPrice.innerText="Do zapłaty ",this.sumPrice.appendChild(t)}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var n=s(0),r=s(1),o=s(4);class a{constructor(){this.config=new n.a,this.api=new r.a,this.admin=new r.a,this.basket=o.a}createMessageElement(e){const t=document.createElement("aside");t.className="message";const s=document.createElement("p");return s.innerText=e,t.appendChild(s),t}productsShop(e){return e.map(e=>{const t=document.createElement("article");return t.dataset.id=e._id,t.className="product",t.dataset.tags="object"==typeof e.tags?e.tags.join(" "):e.tags,t.dataset.category=e.category,this._createProductShop(e,t),t})}_createProductShop(e,t){const{name:s,description:n,price:r,count:o,image:a,category:i}=e,c=document.createElement("img"),d=document.createElement("span");d.className="ImgContainer",c.setAttribute("alt",s),c.src=a,d.appendChild(c);const u=document.createElement("h1");u.innerText=s;const h=document.createElement("p");h.innerText=`Cena: ${r}`;const l=document.createElement("p");l.className="descriptionProduct",l.innerText=n;const m=document.createElement("p");m.innerText=`Dostępnych: ${o}`;const p=document.createElement("div"),k=document.createElement("button");return k.innerText="dodaj do koszyka",k.addEventListener("click",e=>{e.stopImmediatePropagation(),this.basket.addToBasket(t.dataset.id)}),p.appendChild(k),t.append(d),t.append(u),t.append(h),t.append(l),t.append(m),t.append(p),t}singleProductAdmin(e){return this._createTableProducts()}createTableAdmin(){const e=document.createElement("table"),t=document.createElement("thead"),s=document.createElement("tbody"),n=document.createElement("tr"),r=document.createElement("th");r.innerText="Produkt";const o=document.createElement("th");o.innerText="Ilość";const a=document.createElement("th");a.innerText="Cena";const i=document.createElement("th");i.innerText="Id";const c=document.createElement("th");c.innerText="Opis";const d=document.createElement("th");d.innerText="Zdjęcie";const u=document.createElement("th");u.innerText="Tagi";const h=document.createElement("th");return h.innerText="Kategoria",n.appendChild(r),n.appendChild(o),n.appendChild(a),n.appendChild(i),n.appendChild(u),n.appendChild(h),n.appendChild(d),n.appendChild(c),t.appendChild(n),e.appendChild(t),e.appendChild(s),e}adminProduct(e){let t=!1;const s=document.createElement("tr"),n=document.createElement("td"),r=document.createElement("input");r.setAttribute("disabled",!0),r.value=e.name,n.appendChild(r);const o=document.createElement("td"),a=document.createElement("input");a.setAttribute("disabled",!0),a.value=e.count,o.appendChild(a);const i=document.createElement("td"),c=document.createElement("input");c.setAttribute("disabled",!0),c.value=e.price,i.appendChild(c);const d=document.createElement("td");d.innerText=e._id;const u=document.createElement("td"),h=document.createElement("input");h.setAttribute("disabled",!0),h.value=e.description,u.appendChild(h);const l=document.createElement("td");l.classList.add("imageCell");const m=document.createElement("img");m.src=e.image,m.alt=e.name;const p=document.createElement("input");p.setAttribute("disabled",!0),p.setAttribute("type","file"),l.appendChild(m),l.appendChild(p);const k=document.createElement("td"),f=this.adminTags(e);f.forEach(e=>k.appendChild(e));const y=document.createElement("td"),g=document.createElement("select");g.setAttribute("disabled",!0),g.setAttribute("name","category"),this.adminCaregory(e).forEach(e=>g.appendChild(e)),y.appendChild(g);const b=document.createElement("td"),T=document.createElement("button");T.innerText="Odblokuj",T.classList.add("active"),T.addEventListener("click",()=>{if(t){const t={name:r.value,count:a.value,price:c.value,description:h.value,category:g.value,image:p.files[0]?p.files[0]:void 0,tags:this._getTags(k.querySelectorAll('input[type="checkbox"]'))};try{this.api.change(e._id,t)}catch{console.log("błąd przy próbie modyfikacji produktu")}}t=!t,T.classList.toggle("active"),T.innerText=t?"Zatwierdź":"Odblokuj",t?a.removeAttribute("disabled"):a.setAttribute("disabled",!0),t?h.removeAttribute("disabled"):h.setAttribute("disabled",!0),t?r.removeAttribute("disabled"):r.setAttribute("disabled",!0),t?c.removeAttribute("disabled"):c.setAttribute("disabled",!0),t?p.removeAttribute("disabled"):p.setAttribute("disabled",!0),t?a.removeAttribute("disabled"):a.setAttribute("disabled",!0),t?g.removeAttribute("disabled"):g.setAttribute("disabled",!0),t?f.forEach(e=>this.switchBlockTags(e.querySelector("input"),"remove")):f.forEach(e=>this.switchBlockTags(e.querySelector("input"),"add"))}),b.appendChild(T);const C=document.createElement("td"),E=document.createElement("button");return E.innerText="Usuń",E.addEventListener("click",()=>{if(confirm("czy na pewno chcesz usunąć produkt?"))try{this.api.remove(e._id).then(e=>s.remove()).catch(e=>console.log("błąd połączenia"))}catch{console.log("błąd podczas usuwania produktu")}}),C.appendChild(E),s.appendChild(n),s.appendChild(o),s.appendChild(i),s.appendChild(d),s.appendChild(k),s.appendChild(y),s.appendChild(l),s.appendChild(u),s.appendChild(b),s.appendChild(C),s}_getTags(e){const t=[];return e.forEach(e=>{e.checked&&t.push(e.getAttribute("name"))}),t}adminCaregory(e){return this.config.category.map(t=>{const s=document.createElement("option");for(let n in t)s.setAttribute("value",n),s.text=t[n],n===e.category&&s.setAttribute("selected",!0);return s})}switchBlockTags(e,t){"remove"===t&&e.removeAttribute("disabled"),"add"===t&&e.setAttribute("disabled",!0)}adminTags(e){return this.config.tags.map(t=>{const s=e.name+e._id,n=document.createElement("span"),r=document.createElement("input");r.setAttribute("type","checkbox"),r.setAttribute("disabled",!0),r.setAttribute("name",t),0!==("string"==typeof e.tags?e.tags:e.tags.filter(e=>e===t)).length&&r.setAttribute("checked","true"),r.id=s;const o=document.createElement("label");return o.setAttribute("for",s),o.innerText=t,n.appendChild(r),n.appendChild(o),n})}addTagsToAddPanel(){return this.config.tags.map(e=>{const t=`addPanel${e}`,s=document.createElement("span"),n=document.createElement("input");n.setAttribute("type","checkbox"),n.setAttribute("name","tags"),n.setAttribute("value",e),n.id=t;const r=document.createElement("label");return r.setAttribute("for",t),r.innerText=e,s.appendChild(n),s.appendChild(r),s})}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));const n=()=>{document.cookie="accessToken =;Max-Age=0; path=/",document.cookie="refreshToken =;Max-Age=0; path=/",window.location.replace("/?message=Poprawnie wylogowano")}},,,,function(e,t,s){"use strict";s.r(t),s.d(t,"admin",(function(){return i}));var n=s(2),r=s(5),o=s(0),a=(s(3),s(6));const i=new class{constructor(){this.api=new n.a,this.config=new o.a,this.createItems=new r.a,this.checkToken(),this.productsTable=this.createItems.createTableAdmin(),this.productsContainer=document.getElementById("productsContainer"),this.productsContainer&&this.productsContainer.append(this.productsTable),this.productList=this.productsTable.querySelector("tbody"),this.formGetItem=document.getElementById("formGetItem"),this.idGetProduct=document.getElementById("idGetProduct"),this.formAddItem=document.getElementById("formAddItem"),this.formAddItem&&this.formAddItem.addEventListener("submit",this._addProduct.bind(this)),this.logout=document.getElementById("adminLogout"),this.logout&&this.logout.addEventListener("click",a.a),this.addItemPanel=document.querySelector(".addItemContainer"),this.showPanelNewItem=document.getElementById("showPanelNewItem"),this.showPanelNewItem.addEventListener("click",()=>this.addItemPanel.classList.add("show")),this.closeAddPanel=document.getElementById("closeAddContainer"),this.closeAddPanel&&this.closeAddPanel.addEventListener("click",e=>{e.preventDefault(),this.addItemPanel.classList.remove("show")}),this.addItemTagcontainerTr=document.getElementById("addItemTags"),this.addTagsToPanelItem(),this.formGetItem&&this.formGetItem.addEventListener("submit",e=>{e.preventDefault();const t=this.idGetProduct.value;0!==t.length?this.getSingleProduct(t):this.getAllProducts()}),this.checkToken()}async checkToken(){let e,t=this.api.getCookies();if(null!==t&&!t.hasOwnProperty("accessToken")&&t.hasOwnProperty("refreshToken")){if(!await this.api.refreshToken(t.refreshToken))return;t=await this.api.getCookies()}const s=`${this.config.url}/auth/check`,n=t?t.accessToken:null;t&&t.refreshToken;null!==t&&(e=await fetch(s,{method:"POST",headers:{Authorization:`Bearer ${n}`}})),void 0===e||e.status}addTagsToPanelItem(){this.createItems.addTagsToAddPanel().forEach(e=>{this.addItemTagcontainerTr.appendChild(e)})}_addProduct(e){e.preventDefault();const t=e.target.querySelector("#nameAddProduct"),s=e.target.querySelector("#countAddProduct"),n=e.target.querySelector("#descAddProduct"),r=e.target.querySelector("#priceAddProduct"),o=e.target.querySelector("#categoryAddProduct"),a=e.target.querySelector('input[type="file"]'),i=e.target.querySelectorAll('input[type="checkbox"]:checked'),c=Array.prototype.map.call(i,e=>e.value),d={name:t.value,count:s.value,description:n.value,price:r.value,category:o.value,image:a.files[0],tags:c};try{this.api.add(d).then(e=>{const c=document.querySelector("#addMessage");e.ok?(c.className="success",c.innerText=`Dodano produkt: ${t.value}`,t.value="",s.value="",n.value="",r.value="",o.value="",a.value="",i.forEach(e=>e.checked=!1)):(c.className="error",c.innerText=`Błąd podczas dodawania: ${e}`)})}catch(e){console.log("błąd przy próbie dodawania produktu")}}getAllProducts(){try{this.api.getAll().then(e=>{this.productList.innerText="",Array.prototype.forEach.call(e.rows,function(e){const t=this.createItems.adminProduct(e.doc);this.productList.append(t)}.bind(this))})}catch(e){console.log("błąd przy próbie pobrania poduktów")}}getSingleProduct(e){try{this.api.get(e).then(e=>{this.productList.innerText="";const t=this.createItems.adminProduct(e);this.productList.append(t)})}catch(e){console.log("błąd przy próbie pobrania produktu")}}};window.onload=()=>i.checkToken()}]);